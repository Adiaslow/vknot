import{j as t}from"./jsx-runtime.TBa3i5EZ.js";import{r as g}from"./index.CVf8TyFT.js";import{i as be,s as H,l as fe,a as ge}from"./transform.Cr_jfbQC.js";class ee extends Map{constructor(i,x=ve){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:x}}),i!=null)for(const[p,k]of i)this.set(p,k)}get(i){return super.get(te(this,i))}has(i){return super.has(te(this,i))}set(i,x){return super.set(ye(this,i),x)}delete(i){return super.delete(ke(this,i))}}function te({_intern:m,_key:i},x){const p=i(x);return m.has(p)?m.get(p):x}function ye({_intern:m,_key:i},x){const p=i(x);return m.has(p)?m.get(p):(m.set(p,x),x)}function ke({_intern:m,_key:i},x){const p=i(x);return m.has(p)&&(x=m.get(p),m.delete(p)),x}function ve(m){return m!==null&&typeof m=="object"?m.valueOf():m}const se=Symbol("implicit");function ae(){var m=new ee,i=[],x=[],p=se;function k(h){let C=m.get(h);if(C===void 0){if(p!==se)return p;m.set(h,C=i.push(h)-1)}return x[C%x.length]}return k.domain=function(h){if(!arguments.length)return i.slice();i=[],m=new ee;for(const C of h)m.has(C)||m.set(C,i.push(C)-1);return k},k.range=function(h){return arguments.length?(x=Array.from(h),k):x.slice()},k.unknown=function(h){return arguments.length?(p=h,k):p},k.copy=function(){return ae(i,x).unknown(p)},be.apply(k,arguments),k}const Z={positive:{ESI:[{symbol:"H⁺",name:"Proton",mass:1.008},{symbol:"Na⁺",name:"Sodium",mass:22.99},{symbol:"K⁺",name:"Potassium",mass:38.964},{symbol:"NH₄⁺",name:"Ammonium",mass:18.034}],APCI:[{symbol:"H⁺",name:"Proton",mass:1.008},{symbol:"H⁺+H₂O",name:"Proton + Water",mass:19.018}],MALDI:[{symbol:"H⁺",name:"Proton",mass:1.008},{symbol:"Na⁺",name:"Sodium",mass:22.99},{symbol:"K⁺",name:"Potassium",mass:38.964}],"ESI-Orbitrap":[{symbol:"H⁺",name:"Proton",mass:1.008},{symbol:"Na⁺",name:"Sodium",mass:22.99},{symbol:"K⁺",name:"Potassium",mass:38.964},{symbol:"NH₄⁺",name:"Ammonium",mass:18.034},{symbol:"ACN+H⁺",name:"Acetonitrile",mass:42.034}]},negative:{ESI:[{symbol:"H⁻",name:"Deprotonation",mass:-1.008},{symbol:"Cl⁻",name:"Chloride",mass:34.969},{symbol:"HCOO⁻",name:"Formate",mass:44.998},{symbol:"CH₃COO⁻",name:"Acetate",mass:59.013}],APCI:[{symbol:"H⁻",name:"Deprotonation",mass:-1.008},{symbol:"Cl⁻",name:"Chloride",mass:34.969}]}};function Ie(){const m=g.useRef(null),[i,x]=g.useState("positive"),[p,k]=g.useState("ESI"),[h,C]=g.useState(100),[v,oe]=g.useState(1e3),[y,re]=g.useState(.5),[E,L]=g.useState([]),[ne,le]=g.useState([]),[q,z]=g.useState(!1),[R,G]=g.useState(""),[T,W]=g.useState("");g.useEffect(()=>{const e=Z[i][p]||[];L([...e])},[i,p]);const ie=(e,s,o)=>{const b=[];for(const l of e)for(const n of s)for(const N of s){const S=l+N-n,A=S-2*o,a=S+2*o;b.push([A,a])}return b},ce=e=>{if(e.length===0)return[];const s=e.sort((b,l)=>b[0]-l[0]),o=[s[0]];for(let b=1;b<s.length;b++){const l=s[b],n=o[o.length-1];l[0]<=n[1]?n[1]=Math.max(n[1],l[1]):o.push(l)}return o},de=(e,s,o)=>{const l=ce(s);let n=e;for(const[N,S]of l){if(n<N-1e-9)break;n>=N-1e-9&&n<=S+1e-9&&(n=S+1e-9)}return n>o?null:n},{intervals:I,overlaps:$,n:V,delta:me,kappa:ue}=g.useMemo(()=>{if(E.length===0)return{intervals:[],overlaps:new Set,n:0,delta:0,kappa:0};const e=[...E].sort((d,f)=>d.mass-f.mass),s=e[0].mass,o=e[e.length-1].mass,b=e.map(d=>d.mass),l=2*y;if(v-h<=o-s+2*y)return{intervals:[],overlaps:new Set,n:0,delta:l,kappa:0};for(let d=0;d<e.length-1;d++)if(e[d+1].mass-e[d].mass<=2*y)return{intervals:[],overlaps:new Set,n:0,delta:l,kappa:0};const n=[];let N=h+y-s;if(N+o+y>v)return{intervals:[],overlaps:new Set,n:0,delta:l,kappa:0};n.push(N);const S=1e4;for(let d=0;d<S;d++){const f=ie(n,b,y),w=n[n.length-1]+2*y,P=v-o-y,O=de(w,f,P);if(O===null||O+o+y>v)break;n.push(O)}const A=n.length,a=[];n.forEach((d,f)=>{e.forEach(w=>{a.push({peptideIndex:f,adduct:w,lower:d+w.mass-y,upper:d+w.mass+y,mass:d})})});const c=new Set,M=Math.ceil((o-s)/l+1);return{intervals:a,overlaps:c,n:A,delta:l,kappa:M}},[h,v,y,E]),{intervalsByPeptide:we,intervalToRow:B,totalRows:X}=g.useMemo(()=>{if(I.length===0)return{intervalsByPeptide:{},intervalToRow:new Map,totalRows:0};const e=1e-6,s={};I.forEach(a=>{s[a.peptideIndex]||(s[a.peptideIndex]=[]),s[a.peptideIndex].push(a)});const o=[],b=[],l=new Map,n=a=>{const c=Math.min(...a.map(d=>d.lower)),M=Math.max(...a.map(d=>d.upper));return{lower:c,upper:M}},N=(a,c)=>a.upper>c.lower+e&&a.lower<c.upper-e,S=(a,c)=>{const M=n(a);return c.every(d=>!N(M,d))};for(let a=0;a<V;a++){const c=s[a],M=n(c);let d=!1;for(let f=0;f<o.length;f++)if(S(c,b[f])){o[f].push(...c),b[f].push(M),c.forEach(w=>l.set(w,f)),d=!0;break}if(!d){const f=o.length;o.push([...c]),b.push([M]),c.forEach(w=>l.set(w,f))}}const A=o.length;return{intervalsByPeptide:s,intervalToRow:l,totalRows:A}},[I,V]);g.useEffect(()=>{if(!m.current||I.length===0)return;const e=900,s=20,o=4,l=X*(s+o)+o+8/2,n={top:40,right:40,bottom:60,left:60},N=e-n.left-n.right,S=l+n.top+n.bottom,A=H(m.current).attr("width",e).attr("height",S);let a=A.select("g.main-group");a.empty()&&(a=A.append("g").attr("class","main-group")),a.attr("transform",`translate(${n.left},${n.top})`);const c=fe().domain([h,v]).range([0,N]),d=ae(["#3b82f6","#10b981","#8b5cf6","#f59e0b","#06b6d4","#6366f1","#14b8a6","#a855f7"]).domain(E.map(u=>u.symbol)),f=v-h,w=Math.pow(10,Math.floor(Math.log10(f/8))),P=[];P.push(h);let O=Math.ceil(h/w)*w;for(;O<v;)O>h&&P.push(O),O+=w;P[P.length-1]!==v&&P.push(v);let U=a.select("g.x-axis");U.empty()&&(U=a.append("g").attr("class","x-axis")),U.attr("transform",`translate(0,${l})`).call(ge(c).tickValues(P)).style("font-size","12px");let _=a.select("text.x-label");_.empty()&&(_=a.append("text").attr("class","x-label")),_.attr("x",N/2).attr("y",l+45).attr("text-anchor","middle").style("font-size","14px").style("font-weight","600").text("m/z (Da)");let K=A.select("text.title");K.empty()&&(K=A.append("text").attr("class","title")),K.attr("x",e/2).attr("y",20).attr("text-anchor","middle").style("font-size","16px").style("font-weight","700").text("Adduct Interval Visualization");const he=Array.from(new Set(I.map(u=>u.mass)));a.selectAll(".interval").data(I,u=>`${u.peptideIndex}-${u.adduct.symbol}`).join(u=>u.append("rect").attr("class","interval").attr("x",r=>c(r.lower)).attr("y",r=>{const j=B.get(r)||0;return l-(j+1)*(s+o)}).attr("width",r=>c(r.upper)-c(r.lower)).attr("height",s).attr("fill",r=>{const j=I.indexOf(r);return $.has(String(j))?"#ef4444":d(r.adduct.symbol)}).attr("stroke","none").attr("opacity",.7),u=>u.attr("x",r=>c(r.lower)).attr("y",r=>{const j=B.get(r)||0;return l-(j+1)*(s+o)}).attr("width",r=>c(r.upper)-c(r.lower)).attr("height",s).attr("fill",r=>{const j=I.indexOf(r);return $.has(String(j))?"#ef4444":d(r.adduct.symbol)}).attr("opacity",.7),u=>u.remove()).on("mouseover",function(u,r){H(this).attr("opacity",1);const j=B.get(r)||0,D=l-(j+1)*(s+o),F=a.append("g").attr("class","tooltip").attr("transform",`translate(${c((r.lower+r.upper)/2)}, ${D-10})`);F.append("rect").attr("x",-90).attr("y",-30).attr("width",180).attr("height",28).attr("fill","white").attr("stroke","#333").attr("rx",4),F.append("text").attr("text-anchor","middle").attr("y",-10).style("font-size","11px").style("font-weight","600").text(`m${r.peptideIndex} (row ${j}): ${r.adduct.symbol} [${r.lower.toFixed(3)}, ${r.upper.toFixed(3)}]`)}).on("mouseout",function(){H(this).attr("opacity",.7),a.selectAll(".tooltip").remove()});const Q=8;a.selectAll(".mass-marker").data(he,u=>String(u)).join(u=>u.append("line").attr("class","mass-marker"),u=>u,u=>u.remove()).attr("x1",u=>c(u)).attr("x2",u=>c(u)).attr("y1",l-Q/2).attr("y2",l+Q/2).attr("stroke","#000").attr("stroke-width",.5).attr("opacity",.7).on("mouseover",function(u,r){H(this).attr("opacity",1);const j=I.find(F=>F.mass===r)?.peptideIndex,D=a.append("g").attr("class","mass-tooltip").attr("transform",`translate(${c(r)}, ${l+20})`);D.append("rect").attr("x",-50).attr("y",0).attr("width",100).attr("height",28).attr("fill","white").attr("stroke","#333").attr("rx",4),D.append("text").attr("text-anchor","middle").attr("y",18).style("font-size","11px").style("font-weight","600").text(`m${j}: ${r.toFixed(3)} Da`)}).on("mouseout",function(){H(this).attr("opacity",.7),a.selectAll(".mass-tooltip").remove()})},[I,$,B,X,h,v]);const Y=e=>{L(s=>s.find(o=>o.symbol===e.symbol)?s.filter(o=>o.symbol!==e.symbol):[...s,e])},pe=()=>{if(R&&T){const e={symbol:R,name:R,mass:parseFloat(T)};le(s=>[...s,e]),L(s=>[...s,e]),G(""),W(""),z(!1)}},J=$.size===0,xe=Z[i][p]||[];return t.jsxs("div",{className:"my-8 p-6 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:"Ionization Mode"}),t.jsxs("select",{value:i,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 transition-all",children:[t.jsx("option",{value:"positive",children:"Positive Ion Mode"}),t.jsx("option",{value:"negative",children:"Negative Ion Mode"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:"Ionization Method"}),t.jsx("select",{value:p,onChange:e=>k(e.target.value),className:"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 transition-all",children:Object.keys(Z[i]).map(e=>t.jsx("option",{value:e,children:e},e))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:"Active Adducts"}),t.jsxs("div",{className:"space-y-2 bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[xe.map(e=>t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 p-2 rounded transition-colors",children:[t.jsx("input",{type:"checkbox",checked:E.some(s=>s.symbol===e.symbol),onChange:()=>Y(e),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm font-mono text-slate-900 dark:text-slate-100",children:e.symbol}),t.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["(",e.mass.toFixed(3)," Da)"]})]},e.symbol)),ne.map(e=>t.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700 p-2 rounded transition-colors",children:[t.jsx("input",{type:"checkbox",checked:E.some(s=>s.symbol===e.symbol),onChange:()=>Y(e),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),t.jsx("span",{className:"text-sm font-mono text-slate-900 dark:text-slate-100",children:e.symbol}),t.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400",children:["(",e.mass.toFixed(3)," Da)"]})]},e.symbol))]}),!q&&t.jsx("button",{onClick:()=>z(!0),className:"mt-2 px-3 py-1 text-xs font-semibold text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded transition-colors",children:"+ Add Custom Adduct"}),q&&t.jsxs("div",{className:"mt-2 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg space-y-2",children:[t.jsx("input",{type:"text",placeholder:"Name (e.g., Ca²⁺)",value:R,onChange:e=>G(e.target.value),className:"w-full px-3 py-1 text-sm rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100"}),t.jsx("input",{type:"number",step:"0.001",placeholder:"Mass (Da)",value:T,onChange:e=>W(e.target.value),className:"w-full px-3 py-1 text-sm rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:pe,className:"px-3 py-1 text-xs font-semibold bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors",children:"Add"}),t.jsx("button",{onClick:()=>z(!1),className:"px-3 py-1 text-xs font-semibold text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition-colors",children:"Cancel"})]})]})]})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:["Lower Bound (L): ",t.jsxs("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:[h," Da"]})]}),t.jsx("input",{type:"range",min:"50",max:"500",step:"10",value:h,onChange:e=>C(Number(e.target.value)),className:"w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:["Upper Bound (U): ",t.jsxs("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:[v," Da"]})]}),t.jsx("input",{type:"range",min:"500",max:"2000",step:"50",value:v,onChange:e=>oe(Number(e.target.value)),className:"w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300",children:["Resolution (T): ",t.jsxs("span",{className:"font-mono text-blue-600 dark:text-blue-400",children:[y.toFixed(2)," Da"]})]}),t.jsx("input",{type:"range",min:"0.25",max:"2",step:"0.01",value:y,onChange:e=>re(Number(e.target.value)),className:"w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600"})]}),t.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-300 dark:border-slate-600 shadow-sm",children:[t.jsx("h3",{className:"text-sm font-bold mb-3 text-slate-700 dark:text-slate-300",children:"Computed Parameters"}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Number of peptides (n):"}),t.jsx("span",{className:"font-mono font-semibold text-slate-900 dark:text-slate-100",children:V})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Spacing (δ):"}),t.jsxs("span",{className:"font-mono font-semibold text-slate-900 dark:text-slate-100",children:[me.toFixed(3)," Da"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Critical separation (κ):"}),t.jsx("span",{className:"font-mono font-semibold text-slate-900 dark:text-slate-100",children:ue})]}),t.jsxs("div",{className:"flex justify-between items-center pt-2 border-t border-slate-200 dark:border-slate-700",children:[t.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Valid configuration:"}),t.jsx("span",{className:`font-semibold ${J?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:J?"✓ No overlaps":"✗ Overlaps detected"})]})]})]})]})]}),t.jsx("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-300 dark:border-slate-600 shadow-sm",children:t.jsx("svg",{ref:m,className:"w-full"})})]})}export{Ie as default};
