import{j as a}from"./jsx-runtime.TBa3i5EZ.js";import{r as d}from"./index.CVf8TyFT.js";const i=60,o=8,Z=10,C=1,W=1.5;function Q(){const A=d.useRef(null),[m,b]=d.useState(()=>g()),[p,h]=d.useState(!1),[v,O]=d.useState(10),[_,y]=d.useState(0),[B,k]=d.useState(new Set),N=d.useRef(),j=d.useRef(0),[X,D]=d.useTransition(),[E,q]=d.useState(0),M=d.useRef(new Map);function g(){return Array(i).fill(null).map(()=>Array(i).fill(0))}function H(){const n=g();for(let e=0;e<i;e++)for(let s=0;s<i;s++){const r=Math.random();r<.15?n[e][s]=1:r<.3&&(n[e][s]=2)}return n}function J(){const n=g(),e=Math.floor(i/2);for(let s=0;s<i;s++)for(let r=0;r<e;r++)Math.random()<.2&&(n[s][r]=1,n[s][i-1-r]=2);return n}function U(n,e,s){let r=0,t=0,l=0;for(let c=-1;c<=1;c++)for(let u=-1;u<=1;u++){if(c===0&&u===0)continue;const f=e+c,x=s+u;if(f>=0&&f<i&&x>=0&&x<i){const S=n[f][x];S===1?(r++,t++):S===2&&(r++,l++)}}return{total:r,playerA:t,playerB:l}}function V(n){const e=g(),s=new Set;for(let r=0;r<i;r++)for(let t=0;t<i;t++){const l=n[r][t],{total:c,playerA:u,playerB:f}=U(n,r,t);if(c<2){e[r][t]=0;continue}if(c>3){e[r][t]=0,l===1&&f>u?s.add(`${r},${t}`):l===2&&u>f&&s.add(`${r},${t}`);continue}(l!==0||c===3)&&(u>f?e[r][t]=1:f>u?e[r][t]=2:e[r][t]=l)}return{newGrid:e,converted:s}}function P(n,e,s,r){let t=0;const l=Z,c=l*l,u=Math.max(0,e-l),f=Math.min(i-1,e+l),x=Math.max(0,s-l),S=Math.min(i-1,s+l);for(let w=u;w<=f;w++)for(let R=x;R<=S;R++)if(n[w][R]===r){const $=e-w,F=s-R,L=$*$+F*F;L<=c&&(t+=Math.max(0,1-L/c))}return t}d.useEffect(()=>{D(()=>{const n=new Map;for(let e=0;e<i;e++)for(let s=0;s<i;s++){const r=`${e},${s}`;n.set(r,{influenceA:P(m,e,s,1),influenceB:P(m,e,s,2)})}M.current=n,q(e=>e+1)})},[m]);function T(n,e){const s=M.current.get(`${n},${e}`),r=s?.influenceA??0,t=s?.influenceB??0;return r>C&&t>C&&Math.abs(r-t)<W?"contested":r>C&&r>t?"playerA":t>C&&t>r?"playerB":"neutral"}d.useEffect(()=>{const n=A.current;if(!n)return;const e=n.getContext("2d");if(!e)return;const s=i*o,r=i*o;e.clearRect(0,0,s,r);for(let t=0;t<i;t++)for(let l=0;l<i;l++){switch(T(t,l)){case"playerA":e.fillStyle="rgba(59, 130, 246, 0.15)";break;case"playerB":e.fillStyle="rgba(239, 68, 68, 0.15)";break;case"contested":e.fillStyle="rgba(250, 204, 21, 0.2)";break;default:e.fillStyle="rgba(255, 255, 255, 0)"}e.fillRect(l*o,t*o,o,o)}e.strokeStyle="rgba(203, 213, 225, 0.3)",e.lineWidth=1;for(let t=0;t<=i;t++)e.beginPath(),e.moveTo(0,t*o),e.lineTo(s,t*o),e.stroke(),e.beginPath(),e.moveTo(t*o,0),e.lineTo(t*o,r),e.stroke();for(let t=0;t<i;t++)for(let l=0;l<i;l++){const c=m[t][l];c===1?(e.fillStyle="#3b82f6",e.beginPath(),e.arc(l*o+o/2,t*o+o/2,o/3,0,2*Math.PI),e.fill()):c===2&&(e.fillStyle="#ef4444",e.beginPath(),e.arc(l*o+o/2,t*o+o/2,o/3,0,2*Math.PI),e.fill())}for(const t of B){const[l,c]=t.split(",").map(Number);e.fillStyle="#a855f7",e.beginPath(),e.arc(c*o+o/2,l*o+o/2,o/4,0,2*Math.PI),e.fill()}},[m,B,E]),d.useEffect(()=>{if(!p)return;const n=e=>{j.current||(j.current=e);const s=e-j.current,r=1e3/v;s>=r&&(b(t=>{const{newGrid:l,converted:c}=V(t);return k(c),l}),y(t=>t+1),j.current=e),N.current=requestAnimationFrame(n)};return N.current=requestAnimationFrame(n),()=>{N.current&&cancelAnimationFrame(N.current)}},[p,v]);const Y=n=>{const e=A.current;if(!e||p)return;const s=e.getBoundingClientRect(),r=n.clientX-s.left,t=n.clientY-s.top,l=Math.floor(r/o),c=Math.floor(t/o);c>=0&&c<i&&l>=0&&l<i&&b(u=>{const f=u.map(x=>[...x]);return f[c][l]=(f[c][l]+1)%3,f})},I=m.flat().reduce((n,e)=>(e===1&&n.playerA++,e===2&&n.playerB++,n),{playerA:0,playerB:0}),G=d.useMemo(()=>{const n={playerA:0,playerB:0};for(let e=0;e<i;e++)for(let s=0;s<i;s++){const r=T(e,s);r==="playerA"&&n.playerA++,r==="playerB"&&n.playerB++}return n},[E]);return a.jsxs("div",{className:"my-8 p-6 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700",children:[a.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>h(!p),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors",children:p?"Pause":"Start"}),a.jsx("button",{onClick:()=>{h(!1),b(g()),y(0),k(new Set),j.current=0},className:"px-6 py-2 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-lg transition-colors",children:"Reset"}),a.jsx("div",{className:"flex-1"}),a.jsx("button",{onClick:()=>{h(!1),b(g()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Empty"}),a.jsx("button",{onClick:()=>{h(!1),b(H()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Random"}),a.jsx("button",{onClick:()=>{h(!1),b(J()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Symmetric"})]}),a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("label",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 min-w-[60px]",children:"Speed:"}),a.jsx("input",{type:"range",min:"1",max:"60",value:v,onChange:n=>O(Number(n.target.value)),className:"flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600"}),a.jsxs("span",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 min-w-[80px]",children:[v," gen/sec"]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[a.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Generation"}),a.jsx("div",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:_})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[a.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Player A"}),a.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:I.playerA}),a.jsxs("div",{className:"text-xs text-blue-600 dark:text-blue-400 mt-1",children:["Territory: ",G.playerA]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[a.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:"Player B"}),a.jsx("div",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:I.playerB}),a.jsxs("div",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["Territory: ",G.playerB]})]})]}),a.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-300 dark:border-slate-600 shadow-sm",children:[a.jsx("canvas",{ref:A,width:i*o,height:i*o,onClick:Y,className:"cursor-pointer mx-auto block",style:{imageRendering:"pixelated"}}),!p&&a.jsx("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400 mt-3",children:"Click cells to cycle: Empty → Player A (blue) → Player B (red)"})]}),a.jsxs("div",{className:"mt-4 text-sm text-slate-600 dark:text-slate-400",children:[a.jsx("p",{children:a.jsx("strong",{children:"Territory colors (background):"})}),a.jsxs("div",{className:"flex gap-4 mt-2 flex-wrap",children:[a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(59, 130, 246, 0.15)"}}),"Player A territory"]}),a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(239, 68, 68, 0.15)"}}),"Player B territory"]}),a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(250, 204, 21, 0.2)"}}),"Contested"]}),a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"w-4 h-4 rounded bg-purple-500 opacity-70"}),"Competitive death"]})]})]})]})}export{Q as default};
