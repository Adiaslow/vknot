import{j as s}from"./jsx-runtime.TBa3i5EZ.js";import{r as u}from"./index.CVf8TyFT.js";const c=60,o=8,B=10,S=1,D=.5;function H(){const w=u.useRef(null),[h,m]=u.useState(()=>g()),[b,p]=u.useState(!1),[v,G]=u.useState(10),[I,y]=u.useState(0),[C,k]=u.useState(new Set),N=u.useRef(),j=u.useRef(0);function g(){return Array(c).fill(null).map(()=>Array(c).fill(0))}function T(){const n=g();for(let e=0;e<c;e++)for(let i=0;i<c;i++){const r=Math.random();r<.15?n[e][i]=1:r<.3&&(n[e][i]=2)}return n}function M(){const n=g(),e=Math.floor(c/2);for(let i=0;i<c;i++)for(let r=0;r<e;r++)Math.random()<.2&&(n[i][r]=1,n[i][c-1-r]=2);return n}function F(n,e,i){let r=0,t=0,a=0;for(let l=-1;l<=1;l++)for(let f=-1;f<=1;f++){if(l===0&&f===0)continue;const d=e+l,x=i+f;if(d>=0&&d<c&&x>=0&&x<c){const P=n[d][x];P===1?(r++,t++):P===2&&(r++,a++)}}return{total:r,playerA:t,playerB:a}}function L(n){const e=g(),i=new Set;for(let r=0;r<c;r++)for(let t=0;t<c;t++){const a=n[r][t],{total:l,playerA:f,playerB:d}=F(n,r,t);if(l<2||l>3){e[r][t]=0;continue}if(f===d&&l>=2&&l<=3){e[r][t]=a;continue}f>d&&(a!==0&&(l===2||l===3)?(e[r][t]=1,a===2&&i.add(`${r},${t}`)):a===0&&l===3&&(e[r][t]=1)),d>f&&(a!==0&&(l===2||l===3)?(e[r][t]=2,a===1&&i.add(`${r},${t}`)):a===0&&l===3&&(e[r][t]=2))}return{newGrid:e,converted:i}}function R(n,e,i,r){let t=0;for(let a=0;a<c;a++)for(let l=0;l<c;l++)if(n[a][l]===r){const f=e-a,d=i-l,x=Math.sqrt(f*f+d*d);t+=Math.max(0,1-x*x/(B*B))}return t}function O(n,e,i){const r=R(n,e,i,1),t=R(n,e,i,2);return r>S&&t>S&&Math.abs(r-t)<D?"contested":r>S&&r>t?"playerA":t>S&&t>r?"playerB":"neutral"}const A=u.useCallback(()=>{const n=w.current;if(!n)return;const e=n.getContext("2d");if(!e)return;const i=c*o,r=c*o;e.clearRect(0,0,i,r);for(let t=0;t<c;t++)for(let a=0;a<c;a++){switch(O(h,t,a)){case"playerA":e.fillStyle="rgba(59, 130, 246, 0.15)";break;case"playerB":e.fillStyle="rgba(239, 68, 68, 0.15)";break;case"contested":e.fillStyle="rgba(250, 204, 21, 0.2)";break;default:e.fillStyle="rgba(255, 255, 255, 0)"}e.fillRect(a*o,t*o,o,o)}e.strokeStyle="rgba(203, 213, 225, 0.3)",e.lineWidth=1;for(let t=0;t<=c;t++)e.beginPath(),e.moveTo(0,t*o),e.lineTo(i,t*o),e.stroke(),e.beginPath(),e.moveTo(t*o,0),e.lineTo(t*o,r),e.stroke();for(let t=0;t<c;t++)for(let a=0;a<c;a++){const l=h[t][a];l===1?(e.fillStyle="#3b82f6",e.beginPath(),e.arc(a*o+o/2,t*o+o/2,o/3,0,2*Math.PI),e.fill()):l===2&&(e.fillStyle="#ef4444",e.beginPath(),e.arc(a*o+o/2,t*o+o/2,o/3,0,2*Math.PI),e.fill())}for(const t of C){const[a,l]=t.split(",").map(Number);e.fillStyle="#a855f7",e.beginPath(),e.arc(l*o+o/2,a*o+o/2,o/4,0,2*Math.PI),e.fill()}},[h,C]);u.useEffect(()=>{if(!b)return;const n=e=>{j.current||(j.current=e);const i=e-j.current,r=1e3/v;i>=r&&(m(t=>{const{newGrid:a,converted:l}=L(t);return k(l),a}),y(t=>t+1),j.current=e),N.current=requestAnimationFrame(n)};return N.current=requestAnimationFrame(n),()=>{N.current&&cancelAnimationFrame(N.current)}},[b,v]),u.useEffect(()=>{A()},[h,A]);const _=n=>{const e=w.current;if(!e||b)return;const i=e.getBoundingClientRect(),r=n.clientX-i.left,t=n.clientY-i.top,a=Math.floor(r/o),l=Math.floor(t/o);l>=0&&l<c&&a>=0&&a<c&&m(f=>{const d=f.map(x=>[...x]);return d[l][a]=(d[l][a]+1)%3,d})},E=h.flat().reduce((n,e)=>(e===1&&n.playerA++,e===2&&n.playerB++,n),{playerA:0,playerB:0});return s.jsxs("div",{className:"my-8 p-6 bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 rounded-xl shadow-lg border border-slate-200 dark:border-slate-700",children:[s.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>p(!b),className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors",children:b?"Pause":"Start"}),s.jsx("button",{onClick:()=>{p(!1),m(g()),y(0),k(new Set),j.current=0},className:"px-6 py-2 bg-slate-600 hover:bg-slate-700 text-white font-semibold rounded-lg transition-colors",children:"Reset"}),s.jsx("div",{className:"flex-1"}),s.jsx("button",{onClick:()=>{p(!1),m(g()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Empty"}),s.jsx("button",{onClick:()=>{p(!1),m(T()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Random"}),s.jsx("button",{onClick:()=>{p(!1),m(M()),y(0),k(new Set)},className:"px-4 py-2 bg-slate-200 dark:bg-slate-700 hover:bg-slate-300 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 font-medium rounded-lg transition-colors",children:"Symmetric"})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("label",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 min-w-[60px]",children:"Speed:"}),s.jsx("input",{type:"range",min:"1",max:"60",value:v,onChange:n=>G(Number(n.target.value)),className:"flex-1 h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-600"}),s.jsxs("span",{className:"text-sm font-mono text-slate-600 dark:text-slate-400 min-w-[80px]",children:[v," gen/sec"]})]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[s.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400 mb-1",children:"Generation"}),s.jsx("div",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:I})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[s.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Player A (Blue)"}),s.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:E.playerA})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-3 rounded-lg border border-slate-300 dark:border-slate-600",children:[s.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 mb-1",children:"Player B (Red)"}),s.jsx("div",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:E.playerB})]})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 p-4 rounded-lg border border-slate-300 dark:border-slate-600 shadow-sm",children:[s.jsx("canvas",{ref:w,width:c*o,height:c*o,onClick:_,className:"cursor-pointer mx-auto block",style:{imageRendering:"pixelated"}}),!b&&s.jsx("p",{className:"text-center text-sm text-slate-600 dark:text-slate-400 mt-3",children:"Click cells to cycle: Empty → Player A (blue) → Player B (red)"})]}),s.jsxs("div",{className:"mt-4 text-sm text-slate-600 dark:text-slate-400",children:[s.jsx("p",{children:s.jsx("strong",{children:"Territory colors (background):"})}),s.jsxs("div",{className:"flex gap-4 mt-2 flex-wrap",children:[s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(59, 130, 246, 0.15)"}}),"Player A territory"]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(239, 68, 68, 0.15)"}}),"Player B territory"]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:"rgba(250, 204, 21, 0.2)"}}),"Contested"]}),s.jsxs("span",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"w-4 h-4 rounded bg-purple-500 opacity-70"}),"Cell conversion (one frame)"]})]})]})]})}export{H as default};
