---
import { getCollection } from "astro:content";
import BlogLayout from "../layouts/BlogLayout.astro";
import ArticleHeader from "../components/ArticleHeader.astro";

// Get all blog posts and sort by date (newest first)
const allPosts = await getCollection("blog");
const posts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .map((post) => ({
    title: post.data.title,
    summary: post.data.description,
    publishDate: post.data.date.toISOString(),
    tags: post.data.tags,
    href: `/adam-murray/technical/posts/${post.slug}`,
    readingTimeMinutes: post.data.readingTimeMinutes,
  }));
---

<BlogLayout
  title="Adam Murray â€” Technical"
  description="Technical writing, engineering notebooks, and reproducible experiments."
>
  <section class="flex flex-col gap-6">
    <header class="flex flex-col gap-2">
      <h1 class="text-3xl font-semibold text-slate-900">Recent Posts</h1>
      <p class="text-slate-600">
        Production-minded writing on front-end systems, creative tooling, and
        research engineering.
      </p>
    </header>
    <div class="flex flex-col gap-8">
      {
        posts.map((post) => (
          <article class="flex flex-col gap-4 rounded-2xl border border-slate-200 bg-white p-8 shadow-sm">
            <ArticleHeader
              title={post.title}
              summary={post.summary}
              publishDate={post.publishDate}
              tags={post.tags}
              readingTimeMinutes={post.readingTimeMinutes}
            />
            <a
              class="text-sm font-semibold text-slate-900 underline"
              href={post.href}
            >
              Read post
            </a>
          </article>
        ))
      }
    </div>
  </section>
</BlogLayout>
